<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.home.profile.member.repository.MemberProfileMapper">

    <!-- 회원 정보 조회 -->
    <select id="findMemberById" resultType="com.ssafy.home.profile.member.dto.MemberResponse">
        SELECT mid, phone_num, name, email, profile_image_url, last_login, created_at, updated_at
        FROM member
        WHERE mid = #{memberId}
    </select>

    <!-- 회원 정보 수정 -->
    <update id="updateMemberProfile">
        UPDATE member
        <set>
            <if test="request.phoneNum != null and request.phoneNum.trim().length() > 0">
                phone_num = #{request.phoneNum},
            </if>

            <if test="request.name != null and request.name.trim().length() > 0">
                name = #{request.name},
            </if>

            <if test="image != null">
                profile_image_url = #{image},
            </if>
        </set>
        WHERE mid = #{memberId}
    </update>



    <!-- 회원 탈퇴 -->
    <delete id="deleteMemberProfile">
        DELETE FROM member WHERE mid = #{memberId}
    </delete>

    <!-- 비밀번호 변경 -->
    <update id="updatePassword">
        UPDATE member
        SET password = #{newPassword},
            salt     = #{salt}
        WHERE mid = #{memberId}
    </update>
</mapper>
