<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.home.info.repository.EstateChartMapper">

    <resultMap id="EstateDetailResultMap" type="com.ssafy.home.info.dto.EstateDetailResponse">
        <id property="eid" column="eid"/>
        <result property="brokerId" column="broker_id"/>
        <result property="aptSeq" column="apt_seq"/>
<!--        <result property="type" column="type"/>-->
<!--        <result property="status" column="status"/>-->
        <result property="floor" column="floor"/>
        <result property="totalFloor" column="total_floor"/>
        <result property="area" column="area"/>
        <result property="amount" column="amount"/>
        <result property="desc" column="desc"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
<!--        <result property="aptNm" column="apt_nm"/>-->

        <!-- Houseinfo 매핑 -->
        <association property="houseinfo" javaType="com.ssafy.home.info.domain.Houseinfo">
            <id property="aptSeq" column="apt_seq"/>
            <result property="sggCd" column="sgg_cd"/>
            <result property="umdCd" column="umd_cd"/>
            <result property="umdNm" column="umd_nm"/>
            <result property="jibun" column="jibun"/>
            <result property="roadNmSggCd" column="road_nm_sgg_cd"/>
            <result property="roadNm" column="road_nm"/>
            <result property="roadNmBonbun" column="road_nm_bonbun"/>
            <result property="roadNmBubun" column="road_nm_bubun"/>
            <result property="aptNm" column="apt_nm"/>
            <result property="buildYear" column="build_year"/>
            <result property="latitude" column="latitude"/>
            <result property="longitude" column="longitude"/>
        </association>
    </resultMap>

    <!-- 매물 상세 정보 조회 -->
    <select id="getEstateDetails" parameterType="String" resultMap="EstateDetailResultMap">
        SELECT e.eid, e.broker_id, e.apt_seq, e.floor, e.total_floor,
               e.area, e.amount, e.desc, e.created_at, e.updated_at,
               h.apt_nm,
               h.sgg_cd,
               h.umd_cd,
               h.umd_nm,
               h.jibun,
               h.road_nm_sgg_cd,
               h.road_nm,
               h.road_nm_bonbun,
               h.road_nm_bubun,
               h.build_year,
               h.latitude,
               h.longitude
        FROM estate e
        JOIN houseinfos h ON e.apt_seq = h.apt_seq
        WHERE e.apt_seq = #{aptSeq}
    </select>
</mapper>
